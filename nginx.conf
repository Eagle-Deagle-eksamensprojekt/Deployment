user nginx;
events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # Dynamic routing for BidService
    upstream bid_services {
        # Dynamisk rute baseret p√• itemId
        server 127.0.0.1; # Placeholder for dynamisk opsatte BidService-instanser
    }

    server {
        listen 8080;

        # Route for BidService based on itemId
        location ~* /api/bid/(?<itemId>[a-zA-Z0-9]+) {
            # Dynamic routing based on itemId
            set $upstream_bidservice "http://bidservice_$itemId:8080";
            proxy_pass $upstream_bidservice; # Assuming each BidService is mapped dynamically
            proxy_set_header Host $host;
            proxy_set_header X-Item-ID $itemId;

            # Enable logging for debugging
            access_log /var/log/nginx/bid_service.log;
        }

        # Route for AuctionService
        location /auction {
            proxy_pass http://auctionservice:8080;
            proxy_set_header Host $host;
        }

        # Route for ItemService
        location /item {
            proxy_pass http://itemservice:8080;
            proxy_set_header Host $host;
        }

        # Route for UserService
        location /api/user {
            proxy_pass http://userservice:8080;
            proxy_set_header Host $host;
        }

        # Route for AuthService
        location /auth {
            proxy_pass http://authservice:8080;
            proxy_set_header Host $host;
        }

        # Default fallback for undefined routes
        location / {
            return 404;
        }

        # Custom error page
        error_page 404 /404.html;
    }
}
